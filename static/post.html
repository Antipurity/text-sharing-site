<!DOCTYPE html>
{{#with (GetPostById post user)}}
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>{{GetSummary this}}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="/post.css" rel="stylesheet">
  </head>
  <body>
    <main>
      <!-- TODO: ...What about login? How to login, show that we're logged in (via a link to our first post, and possibly its summary), and logout, all in the corner of every page?... -->
      <article class="post top-level">
        <!-- TODO: Zeroth, if not top-level, include a link to the parent. (Or maybe always.) (Do we want it to be human-readable? We'd need to read the parent post, right? I guess it's not *that* much of a problem.) -->
        <div class="summary">
          <div class="reward">
            <!-- TODO: If logged in, the "- reward" button, highlighted if the user gave it -1 reward. -->
            <!--   ...How would we wire it up... JS, and data in attributes post_id/amount? -->
            <!--   ...How would we even check whether we're logged in... -->
            {{GetPostReward this}}
            <!-- TODO: If logged in, the "+ reward" button, highlighted if the user gave it +1 reward. -->
            <!--   ...How would we wire it up... JS, and data in attributes post_id/amount? -->
            <!--   ...How would we even check whether we're logged in... -->
            <!-- TODO: If (GetEditable this ../user), also the "delete" button (-100 reward). -->
          </div>
          <strong>{{GetSummary this}}</strong>
        </div>
        <div class="content">{{{(GetContent this)}}}</div>
        <!-- TODO: The collapsed prompt to edit if (GetEditable this ../user), given post_id,content,rights. -->
        <div class="children">
          <!-- TODO: The collapsed prompt to add a new child, if (GetPostable this ../user), given parent_id,content,rights. -->
          <!--   TODO: ...Wait, how would we allow adding users: `new` reads the `user` cookie, but it's only set on `login`... -->
          <div class="children-pagination">
            <p>{{this.children}} comments</p>
            <!-- TODO: How to do pagination? For each page, display a link to it unless it's the current page? But we'd like to only display the neighborhood and start/end... Should really have a helper, returning an array of page-indices... -->
            {{GetPostChildrenLength this}} pages
          </div>
          {{#each (GetPostChildren this ../user ../page)}}
            <!-- TODO: How to display the child's reward+summaries? Need to first finalize how the parent displays rewards, right? -->
            CHILD: {{GetSummary this}}
            <!-- TODO: (Would like to wrap their contents in <details>. And summaries should be human-readable URLs to them.) -->
          {{/each}}
        </div>
      </article>
      <!-- TODO: Write down all other visual components that we want. -->
      <!--   ...Is that basically all we want, apart from user-specific stuff? ...Maybe said user-specific stuff should be in the post-viewer, detected when viewing the user's first post... -->
      <!-- TODO: Also link to a JS script that iterates over all reward buttons and attaches appropriate click listeners. -->
    </main>
  </body>
</html>
{{/with}}