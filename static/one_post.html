<article class="post">
  {{#if (GetNotTopLevel post)}}
    <a href="{{lookup (GetPostById parent_id ../user) "human_readable_url"}}">â†‘ parent</a>
  {{/if}}
  <details open class="post">
    <summary class="summary-row">
      <div class="reward">
        <!-- TODO: (Make the rewarding UI bearable, once we can see it, with login fully working.) -->
        {{#if (GetEditable post ../user)}}
          {{#if logged_in}}
            <form action="/reward" method="post">
              <input type="hidden" name="post_id" value="{{id}}">
              <button class="btn {{#if (GetUserReward post -100)}}btn-primary{{else}}btn-light{{/if}}" name="amount" value="-100">delete</button>
            </form>
          {{/if}}
        {{/if}}
        {{#if logged_in}}
          <form action="/reward" method="post">
            <input type="hidden" name="post_id" value="{{id}}">
            <button class="btn {{#if (GetUserReward post -1)}}btn-primary{{else}}btn-light{{/if}}" name="amount" value="-1">-</button>
          </form>
        {{/if}}
        {{#if logged_in}}
          <form action="/reward" method="post">
            <input type="hidden" name="post_id" value="{{id}}">
            <button class="btn {{#if (GetUserReward post 0)}}btn-primary{{else}}btn-light{{/if}}" name="amount" value="0">-</button>
          </form>
        {{else}}
          {{GetPostReward post}}
        {{/if}}
        {{#if logged_in}}
          <form action="/reward" method="post">
            <input type="hidden" name="post_id" value="{{id}}">
            <button class="btn {{#if (GetUserReward post 1)}}btn-primary{{else}}btn-light{{/if}}" name="amount" value="1">+</button>
          </form>
        {{/if}}
      </div>
      {{#if (Less depth 1)}}
        <strong>{{GetSummary post}}</strong>
      {{else}}
        <a href="{{lookup post "human_readable_url"}}"><strong>{{GetSummary post}}</strong></a>
      {{/if}}
      <div class="comment-count">{{post.children}} comments</div>
      <!-- TODO: ...Shouldn't we also fetch the post's author, and its first-post, and display *its* summary, to tell who the post's by?... -->
    </summary>
    <!-- TODO: The collapsed prompt to edit if (GetEditable post ../user), given post_id,content,rights. -->
    {{#if (Less depth 1)}}
      <div class="content">{{{(GetContent post)}}}</div>
      <!-- TODO: The collapsed prompt to add a new child, if (GetPostable post ../user), given parent_id,content,rights. -->
      <!--   TODO: ...Wait, how would we allow adding users: `new` reads the `user` cookie, but it's only set on `login`... Don't we need to pass in the intended user to `new`? (Yeah. And if logged in, pass in `user`.) -->
      <div class="children-pagination">
        <!-- TODO: How to do pagination? For each page, display a link to it unless it's the current page? But we'd like to only display the neighborhood and start/end... Should really have a helper, returning an array of page-indices... -->
        {{GetPostChildrenLength post}} pages
      </div>
      {{#each (GetPostChildren post ../user ../page)}}
        {{> one_post depth=(Plus1 depth) post=(GetPostById post user) user=user page=page}}
      {{/each}}
    {{/if}}
  </details>
</article>
<!-- TODO: Write down all other visual components that we want. -->
<!--   ...Is that basically all we want, apart from user-specific stuff? ...Maybe said user-specific stuff should be in the post-viewer, detected when viewing the user's first post... -->